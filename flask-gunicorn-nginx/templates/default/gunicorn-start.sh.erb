#!/bin/bash

# Launch Gunicorn server
# The purpose of this script is to set some environment variables before launching gunicorn server.

cd <%= @app_dir %>

source venv/bin/activate

exec gunicorn \
    <%= node['flask-gunicorn-nginx']['wsgi_module'] %> \
    --name "`git show --pretty=format:"%h %s" -s HEAD`"
    --workers=<%= node['flask-gunicorn-nginx']['gunicorn']["workers"] %> \
    --timeout=<%= node['flask-gunicorn-nginx']['gunicorn']["timeout"] %> \
    --log-level=<%= node['flask-gunicorn-nginx']['gunicorn']["log-level"] %> \
    --worker-class=<%= node['flask-gunicorn-nginx']['gunicorn']["worker-class"] %> \
    --pid=<%= File.join(helper.deploy_to, "run/gunicorn-master.pid") %> \
    --log-syslog-to=<%= helper.gunicorn_syslog %>
